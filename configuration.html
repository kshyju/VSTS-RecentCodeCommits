<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="sdk/scripts/VSS.SDK.js"></script>
    <script type="text/javascript">
                VSS.init({
                    explicitNotifyLoaded: true,
                    usePlatformStyles: true
                });

                VSS.require("TFS/Dashboards/WidgetHelpers", function (WidgetHelpers) {
					WidgetHelpers.IncludeWidgetStyles();
					
					WidgetHelpers.IncludeWidgetConfigurationStyles();
                    VSS.register("RecentCodeCommitsWidgetConfiguration", function () {
                        var $queryDropdown = $("#data-dropdown");
						var $sourceCodePath = $("#sourceCodePath");

                        return {
                            load: function (widgetSettings, widgetConfigurationContext) {
                                var settings = JSON.parse(widgetSettings.customSettings.data);
                                if (settings && settings.dataFor) {
                                    $queryDropdown.val(settings.dataFor);
                                }
                                if (settings && settings.sourceCodePath) {
                                    $sourceCodePath.val(settings.sourceCodePath);
                                }

                                 $queryDropdown.on("change", function () {
                                     var customSettings = { data: JSON.stringify({ dataFor: $queryDropdown.val(), sourceCodePath: $sourceCodePath .val()}) };
                                     var eventName = WidgetHelpers.WidgetEvent.ConfigurationChange;
                                     var eventArgs = WidgetHelpers.WidgetEvent.Args(customSettings);
                                     widgetConfigurationContext.notify(eventName, eventArgs);
                                 });

                                 $sourceCodePath.on("blur", function () {
                                     var customSettings = { data: JSON.stringify({ dataFor: $queryDropdown.val(), sourceCodePath: $sourceCodePath.val() }) };
                                     var eventName = WidgetHelpers.WidgetEvent.ConfigurationChange;
                                     var eventArgs = WidgetHelpers.WidgetEvent.Args(customSettings);
                                     widgetConfigurationContext.notify(eventName, eventArgs);
                                 });

                                return WidgetHelpers.WidgetStatusHelper.Success();
                            },
                            onSave: function() {
                                var customSettings = { data: JSON.stringify({ dataFor: $queryDropdown.val(), sourceCodePath: $sourceCodePath.val() }) };
                                return WidgetHelpers.WidgetConfigurationSave.Valid(customSettings);
                            }
                        }
                    });
                    VSS.notifyLoadSucceeded();
                });
    </script>
</head>
<body>
    
    <div class="widget-configuration">
        <div class="widget-configuration">
            <div class="dropdown">
                <label>Get data for</label>
                <div class="wrapper">
                    <select id="data-dropdown">
                        <option value="nofilter" selected>No filter</option>
                        <option value="currentsprint">Current Sprint</option>
                        <option value="24hrs">Last 24 Hours</option>
                        <option value="7days">Last 7 days</option>
                    </select>
                </div>
            </div>
            <div class="single-line-text-input" style="margin-top: 10px;">
                <label>Source code path</label>
                <input type="text" id="sourceCodePath" placeholder="Your source code path(ex: $/Foo/Bar )" />
                <span class="inline-error-configuration"><span class="inline-error-text"><i>Specify the TFS source code path here. Leave empty to get data from the root project</i></span></span>
            </div>
        </div>

        </div>


</body>
</html>